<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treasure Hunt Academy - Interactive Learning Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Adventure', 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 25%, #8B4513 50%, #DAA520 100%);
            overflow: hidden;
            height: 100vh;
            color: white;
        }

        .treasure-map {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="parchment" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><rect width="20" height="20" fill="%23F4A460"/><circle cx="10" cy="10" r="1" fill="%23D2691E" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23parchment)" opacity="0.9"/></svg>') repeat;
        }

        .explorer {
            position: absolute;
            bottom: 50px;
            left: 50px;
            width: 60px;
            height: 80px;
            background: linear-gradient(45deg, #8B4513, #CD853F);
            border-radius: 30px 30px 15px 15px;
            transition: all 0.8s ease;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .explorer::before {
            content: 'üß≠';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 35px;
        }

        .explorer.moving {
            transform: scale(1.1);
        }

        .treasure-location {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid transparent;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .treasure-location.locked {
            background: linear-gradient(45deg, #696969, #2F4F4F);
            border-color: #1C1C1C;
            opacity: 0.6;
            cursor: not-allowed;
        }

        .treasure-location.available {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-color: #FF6347;
            animation: treasure-glow 2s infinite;
        }

        .treasure-location.completed {
            background: linear-gradient(45deg, #00FF7F, #32CD32);
            border-color: #228B22;
        }

        @keyframes treasure-glow {
            0%, 100% { 
                box-shadow: 0 6px 15px rgba(255,215,0,0.6);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 6px 25px rgba(255,215,0,1);
                transform: scale(1.1);
            }
        }

        .treasure-path {
            position: absolute;
            height: 4px;
            background: linear-gradient(90deg, transparent, #FFD700, transparent);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .treasure-path.visible {
            opacity: 1;
        }

        .quest-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .quest-modal.active {
            display: flex;
        }

        .quest-scroll {
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            border: 5px solid #DAA520;
            position: relative;
        }

        .quest-scroll::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #DAA520, #FFD700);
            border-radius: 25px;
            z-index: -1;
        }

        .quest-title {
            font-size: 32px;
            margin-bottom: 20px;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .treasure-info {
            font-size: 18px;
            margin-bottom: 20px;
            color: #F0E68C;
            font-style: italic;
        }

        .riddle-text {
            font-size: 22px;
            margin-bottom: 30px;
            line-height: 1.6;
            background: rgba(0,0,0,0.3);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #FFD700;
            text-align: left;
            font-family: 'Courier New', monospace;
        }

        .clue-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .clue-option {
            padding: 20px;
            background: linear-gradient(45deg, #4682B4, #5F9EA0);
            border: 3px solid transparent;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }

        .clue-option:hover {
            background: linear-gradient(45deg, #5F9EA0, #20B2AA);
            border-color: #FFD700;
            transform: translateY(-5px);
        }

        .clue-option.selected {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-color: #FF6347;
            color: #000;
        }

        .clue-option.correct {
            background: linear-gradient(45deg, #00FF7F, #32CD32);
            border-color: #228B22;
        }

        .clue-option.incorrect {
            background: linear-gradient(45deg, #FF6347, #DC143C);
            border-color: #8B0000;
        }

        .treasure-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .solve-btn {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
        }

        .hint-btn {
            background: linear-gradient(45deg, #9B59B6, #8E44AD);
            color: white;
        }

        .continue-btn {
            background: linear-gradient(45deg, #2ECC71, #27AE60);
            color: white;
            display: none;
        }

        .action-btn:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .quest-result {
            margin: 25px 0;
            padding: 20px;
            border-radius: 15px;
            display: none;
            font-size: 18px;
            line-height: 1.6;
        }

        .quest-result.success {
            background: linear-gradient(45deg, rgba(46,204,113,0.3), rgba(39,174,96,0.3));
            border: 3px solid #2ECC71;
            color: #2ECC71;
            display: block;
        }

        .quest-result.failure {
            background: linear-gradient(45deg, rgba(231,76,60,0.3), rgba(192,57,43,0.3));
            border: 3px solid #E74C3C;
            color: #E74C3C;
            display: block;
        }

        .adventure-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            z-index: 100;
        }

        .treasure-count {
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .explorer-level {
            font-size: 18px;
            color: #87CEEB;
            margin-bottom: 10px;
        }

        .quest-progress {
            font-size: 16px;
            color: #98FB98;
        }

        .map-legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 15px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
        }

        .locked-icon { background: linear-gradient(45deg, #696969, #2F4F4F); }
        .available-icon { background: linear-gradient(45deg, #FFD700, #FFA500); }
        .completed-icon { background: linear-gradient(45deg, #00FF7F, #32CD32); }

        .magic-sparkles {
            position: absolute;
            font-size: 20px;
            color: #FFD700;
            opacity: 0;
            pointer-events: none;
            animation: sparkle 2s ease-out;
        }

        @keyframes sparkle {
            0% { opacity: 1; transform: scale(0.5) translateY(0); }
            50% { opacity: 1; transform: scale(1) translateY(-20px); }
            100% { opacity: 0; transform: scale(0.5) translateY(-40px); }
        }

        .learning-tip {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(45deg, rgba(138,43,226,0.2), rgba(75,0,130,0.2));
            border: 2px solid #8A2BE2;
            border-radius: 15px;
            color: #DDA0DD;
            font-style: italic;
            display: none;
        }

        .learning-tip.visible {
            display: block;
        }
    </style>
</head>
<body>
    <div class="treasure-map">
        <div class="explorer" id="explorer"></div>

        <div class="adventure-ui">
            <div class="treasure-count">üíé Treasures: <span id="treasureCount">0</span>/5</div>
            <div class="explorer-level">üó∫Ô∏è Explorer Level: <span id="explorerLevel">Novice</span></div>
            <div class="quest-progress">üéØ Progress: <span id="questProgress">0%</span></div>
        </div>

        <!-- Treasure locations will be generated dynamically -->
        <div id="treasureLocations"></div>

        <div class="quest-modal" id="questModal">
            <div class="quest-scroll">
                <div class="quest-title" id="questTitle">
                    <span>üóùÔ∏è</span>
                    <span>Ancient Riddle</span>
                    <span>üóùÔ∏è</span>
                </div>
                <div class="treasure-info" id="treasureInfo">Solve this riddle to claim the treasure!</div>
                <div class="riddle-text" id="riddleText">Loading riddle from ancient scrolls...</div>
                <div class="clue-options" id="clueOptions"></div>
                <div class="quest-result" id="questResult"></div>
                <div class="learning-tip" id="learningTip"></div>
                <div class="treasure-actions">
                    <button class="action-btn solve-btn" id="solveBtn">üîç Solve Riddle</button>
                    <button class="action-btn hint-btn" id="hintBtn">üí° Ancient Wisdom</button>
                    <button class="action-btn continue-btn" id="continueBtn">üöÄ Continue Quest</button>
                </div>
            </div>
        </div>

        <div class="map-legend">
            <div class="legend-item">
                <span class="legend-icon locked-icon"></span>
                <span>Locked Treasure</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon available-icon"></span>
                <span>Available Quest</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon completed-icon"></span>
                <span>Claimed Treasure</span>
            </div>
        </div>
    </div>

    <script>
        // Game Configuration
        const API_BASE = 'http://localhost:5000/api';

        // Adventure State
        let adventureState = {
            treasuresFound: 0,
            totalTreasures: 5,
            explorerLevel: 'Novice',
            completedQuests: [],
            availableQuests: [0], // First treasure is always available
            sessionId: null,
            currentQuestData: null
        };

        // Treasure Map Configuration
        const treasureMap = [
            {
                id: 0,
                name: "Crystal Cave",
                x: 150, y: 200,
                icon: "üíé",
                subject: "Mathematics",
                class: 6,
                difficulty: "easy",
                riddle: "In the crystal cave, numbers dance and play. If you have 3 groups of 8 crystals each, how many crystals do you have in total?",
                options: ["21", "24", "27", "32"],
                correct: 1,
                explanation: "3 groups √ó 8 crystals = 24 crystals total. Multiplication helps us count groups quickly!",
                mnemonic: "Think of it as 3 √ó 8 = 24. Remember: 3 √ó 8 = 'Three Ate' = 24!",
                reward: "Mystic Crystal of Multiplication"
            },
            {
                id: 1,
                name: "Enchanted Forest",
                x: 400, y: 150,
                icon: "üå≥",
                subject: "Science",
                class: 7,
                difficulty: "medium",
                riddle: "Deep in the enchanted forest, the ancient oak whispers secrets of life. What do all living trees need to create their own food through photosynthesis?",
                options: ["Only water", "Only sunlight", "Sunlight, water, and carbon dioxide", "Only soil nutrients"],
                correct: 2,
                explanation: "Trees need sunlight (energy), water (from roots), and carbon dioxide (from air) for photosynthesis to make glucose (sugar).",
                mnemonic: "Remember SUN-WATER-CO2 = 'Super Wonderful Chemistry' for making plant food! üå±",
                reward: "Leaf of Eternal Knowledge"
            },
            {
                id: 2,
                name: "Ancient Library",
                x: 650, y: 250,
                icon: "üìö",
                subject: "History",
                class: 8,
                difficulty: "medium",
                riddle: "In the dusty scrolls of the ancient library, you discover tales of a great emperor who united India around 321 BCE. Who was this mighty ruler?",
                options: ["Akbar", "Chandragupta Maurya", "Ashoka", "Harsha"],
                correct: 1,
                explanation: "Chandragupta Maurya founded the Mauryan Empire around 321 BCE and was the first to unite most of the Indian subcontinent.",
                mnemonic: "Chandragupta = 'Chandra' (moon) + 'gupta' (protected). The moon-protected emperor who started it all!",
                reward: "Scroll of Ancient Wisdom"
            },
            {
                id: 3,
                name: "Mystic Mountains",
                x: 300, y: 350,
                icon: "‚õ∞Ô∏è",
                subject: "Mathematics",
                class: 8,
                difficulty: "hard",
                riddle: "At the peak of the mystic mountain, you find an equation carved in stone: x + 15 = 27. What is the value of the mysterious x?",
                options: ["10", "12", "15", "42"],
                correct: 1,
                explanation: "To solve x + 15 = 27, subtract 15 from both sides: x = 27 - 15 = 12",
                mnemonic: "Think: What number plus 15 equals 27? Count up: 15 + ? = 27, so ? = 12!",
                reward: "Stone of Mathematical Truth"
            },
            {
                id: 4,
                name: "Dragon's Lair",
                x: 550, y: 400,
                icon: "üêâ",
                subject: "Science",
                class: 9,
                difficulty: "hard",
                riddle: "The wise dragon guards the final treasure with a riddle about the elements: 'I am the most abundant gas in Earth's atmosphere, making up about 78%. What am I?'",
                options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Argon"],
                correct: 2,
                explanation: "Nitrogen makes up about 78% of Earth's atmosphere, while Oxygen is about 21%.",
                mnemonic: "Remember: N-78 = 'Nitrogen - Seventy-Eight'! The dragon breathes mostly nitrogen!",
                reward: "Dragon's Breath of Ultimate Knowledge"
            }
        ];

        let selectedClue = null;

        // Initialize Adventure
        async function initAdventure() {
            try {
                // Start session with backend
                const response = await fetch(`${API_BASE}/subway-surfer/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        player_name: prompt('Enter your explorer name:') || 'Treasure Hunter'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    adventureState.sessionId = data.session_id;
                }
            } catch (error) {
                console.error('Failed to initialize session:', error);
            }

            createTreasureLocations();
            updateAdventureUI();
            showWelcomeMessage();
        }

        function createTreasureLocations() {
            const container = document.getElementById('treasureLocations');
            container.innerHTML = '';

            treasureMap.forEach((treasure, index) => {
                // Create treasure location
                const location = document.createElement('div');
                location.className = 'treasure-location';
                location.style.left = treasure.x + 'px';
                location.style.top = treasure.y + 'px';
                location.textContent = treasure.icon;
                location.dataset.id = treasure.id;

                // Set treasure state
                if (adventureState.completedQuests.includes(treasure.id)) {
                    location.classList.add('completed');
                    location.title = `${treasure.name} - Treasure Claimed! üèÜ`;
                } else if (adventureState.availableQuests.includes(treasure.id)) {
                    location.classList.add('available');
                    location.title = `${treasure.name} - Click to start quest!`;
                    location.onclick = () => startQuest(treasure.id);
                } else {
                    location.classList.add('locked');
                    location.title = `${treasure.name} - Complete previous quests to unlock`;
                }

                container.appendChild(location);

                // Create path to next treasure if available
                if (index < treasureMap.length - 1 && adventureState.completedQuests.includes(treasure.id)) {
                    createTreasurePath(treasure, treasureMap[index + 1]);
                }
            });
        }

        function createTreasurePath(fromTreasure, toTreasure) {
            const path = document.createElement('div');
            path.className = 'treasure-path visible';
            
            const deltaX = toTreasure.x - fromTreasure.x;
            const deltaY = toTreasure.y - fromTreasure.y;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            
            path.style.width = distance + 'px';
            path.style.left = (fromTreasure.x + 40) + 'px';
            path.style.top = (fromTreasure.y + 40) + 'px';
            path.style.transform = `rotate(${angle}deg)`;
            path.style.transformOrigin = '0 50%';
            
            document.getElementById('treasureLocations').appendChild(path);
        }

        async function startQuest(treasureId) {
            const treasure = treasureMap.find(t => t.id === treasureId);
            if (!treasure) return;

            adventureState.currentQuestData = treasure;

            try {
                // Fetch question from API
                const response = await fetch(`${API_BASE}/subway-surfer/question`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: adventureState.sessionId,
                        subject: treasure.subject,
                        class: treasure.class,
                        difficulty: treasure.difficulty
                    })
                });

                const data = await response.json();
                if (data.success && data.question) {
                    showQuestModal(data.question, treasure);
                } else {
                    showQuestModal(treasure, treasure);
                }
            } catch (error) {
                console.error('Failed to fetch question:', error);
                showQuestModal(treasure, treasure);
            }

            // Animate explorer movement
            moveExplorerTo(treasure.x + 20, treasure.y + 80);
        }

        function showQuestModal(question, treasure) {
            document.getElementById('questTitle').innerHTML = `
                <span>${treasure.icon}</span>
                <span>${treasure.name}</span>
                <span>${treasure.icon}</span>
            `;
            
            document.getElementById('treasureInfo').textContent = 
                `${treasure.subject} Quest ‚Ä¢ Class ${treasure.class} ‚Ä¢ ${treasure.difficulty.toUpperCase()} Level`;
            
            document.getElementById('riddleText').textContent = question.riddle || question.question;

            // Create clue options
            const optionsContainer = document.getElementById('clueOptions');
            optionsContainer.innerHTML = '';
            const options = question.options || treasure.options;

            options.forEach((option, index) => {
                const clueOption = document.createElement('div');
                clueOption.className = 'clue-option';
                clueOption.textContent = option;
                clueOption.onclick = () => selectClue(index);
                optionsContainer.appendChild(clueOption);
            });

            // Reset UI
            document.getElementById('questResult').style.display = 'none';
            document.getElementById('learningTip').classList.remove('visible');
            document.getElementById('solveBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';
            selectedClue = null;

            document.getElementById('questModal').classList.add('active');
        }

        function selectClue(index) {
            selectedClue = index;
            
            // Update visual selection
            document.querySelectorAll('.clue-option').forEach((option, i) => {
                option.classList.toggle('selected', i === index);
            });
        }

        async function solveRiddle() {
            if (selectedClue === null) {
                alert('ü§î Choose a clue first, brave explorer!');
                return;
            }

            const treasure = adventureState.currentQuestData;
            const isCorrect = selectedClue === treasure.correct;

            try {
                if (adventureState.sessionId) {
                    const response = await fetch(`${API_BASE}/subway-surfer/answer`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            session_id: adventureState.sessionId,
                            question_id: treasure.id,
                            answer_index: selectedClue,
                            response_time: 5000
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        handleQuestResult(data.correct, data.explanation, data.ai_hint);
                        return;
                    }
                }
            } catch (error) {
                console.error('API call failed:', error);
            }

            // Fallback to offline processing
            handleQuestResult(isCorrect, treasure.explanation, null);
        }

        function handleQuestResult(isCorrect, explanation, aiHint) {
            const treasure = adventureState.currentQuestData;
            
            // Show correct answer
            document.querySelectorAll('.clue-option').forEach((option, index) => {
                if (index === treasure.correct) {
                    option.classList.add('correct');
                } else if (index === selectedClue && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });

            // Show result
            const resultArea = document.getElementById('questResult');
            const learningTip = document.getElementById('learningTip');

            if (isCorrect) {
                resultArea.className = 'quest-result success';
                resultArea.innerHTML = `
                    üèÜ <strong>Treasure Found!</strong><br>
                    ${explanation}<br><br>
                    <em>You have claimed the ${treasure.reward}!</em>
                `;
                
                // Show mnemonic
                if (treasure.mnemonic) {
                    learningTip.innerHTML = `
                        <strong>üí° Memory Magic:</strong><br>
                        ${treasure.mnemonic}
                    `;
                    learningTip.classList.add('visible');
                }

                // Complete the quest
                completeQuest(treasure.id);
                createSparkles(treasure.x + 40, treasure.y + 40);
                
            } else {
                resultArea.className = 'quest-result failure';
                resultArea.innerHTML = `
                    ü§î <strong>Not quite right, explorer!</strong><br>
                    ${explanation}<br>
                    ${aiHint ? `<br>üí° <em>Ancient Wisdom: ${aiHint}</em>` : ''}
                `;

                if (treasure.mnemonic) {
                    learningTip.innerHTML = `
                        <strong>üéØ Learning Hint:</strong><br>
                        ${treasure.mnemonic}
                    `;
                    learningTip.classList.add('visible');
                }
            }

            // Hide solve button, show continue
            document.getElementById('solveBtn').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function completeQuest(treasureId) {
            if (!adventureState.completedQuests.includes(treasureId)) {
                adventureState.completedQuests.push(treasureId);
                adventureState.treasuresFound++;
                
                // Unlock next treasure
                if (treasureId + 1 < treasureMap.length) {
                    if (!adventureState.availableQuests.includes(treasureId + 1)) {
                        adventureState.availableQuests.push(treasureId + 1);
                    }
                }
                
                // Update explorer level
                updateExplorerLevel();
                updateAdventureUI();
            }
        }

        function updateExplorerLevel() {
            const levels = ['Novice', 'Explorer', 'Adventurer', 'Treasure Hunter', 'Legend'];
            adventureState.explorerLevel = levels[Math.min(adventureState.treasuresFound, levels.length - 1)];
        }

        async function getAncientWisdom() {
            if (!adventureState.currentQuestData) return;

            try {
                const response = await fetch(`${API_BASE}/ai/hint`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: adventureState.currentQuestData.riddle,
                        options: adventureState.currentQuestData.options,
                        subject: adventureState.currentQuestData.subject
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert(`üîÆ Ancient Oracle speaks: ${data.hint}`);
                } else {
                    alert('üîÆ The ancient spirits whisper: "Think carefully about what you have learned. The answer lies within your knowledge."');
                }
            } catch (error) {
                alert('üîÆ Ancient Oracle: "Break the riddle into smaller parts. What clues can you find in the question itself?"');
            }
        }

        function continueQuest() {
            document.getElementById('questModal').classList.remove('active');
            createTreasureLocations();
            
            // Check if all treasures are found
            if (adventureState.treasuresFound >= adventureState.totalTreasures) {
                setTimeout(() => {
                    alert(`üèÜ CONGRATULATIONS! üèÜ\n\nYou have found all ${adventureState.totalTreasures} treasures and become a true Legend!\n\nYour knowledge has unlocked the greatest treasure of all - WISDOM! üìö‚ú®`);
                }, 500);
            }
        }

        function moveExplorerTo(x, y) {
            const explorer = document.getElementById('explorer');
            explorer.classList.add('moving');
            explorer.style.left = x + 'px';
            explorer.style.bottom = (window.innerHeight - y - 80) + 'px';
            
            setTimeout(() => {
                explorer.classList.remove('moving');
            }, 800);
        }

        function createSparkles(x, y) {
            for (let i = 0; i < 5; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'magic-sparkles';
                sparkle.textContent = '‚ú®';
                sparkle.style.left = (x + Math.random() * 60 - 30) + 'px';
                sparkle.style.top = (y + Math.random() * 60 - 30) + 'px';
                
                document.querySelector('.treasure-map').appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 2000);
            }
        }

        function updateAdventureUI() {
            document.getElementById('treasureCount').textContent = adventureState.treasuresFound;
            document.getElementById('explorerLevel').textContent = adventureState.explorerLevel;
            document.getElementById('questProgress').textContent = 
                Math.round((adventureState.treasuresFound / adventureState.totalTreasures) * 100) + '%';
        }

        function showWelcomeMessage() {
            setTimeout(() => {
                alert('üó∫Ô∏è Welcome, brave explorer!\n\n' +
                      'üéØ Your quest: Find 5 ancient treasures hidden across the realm!\n' +
                      'üíé Each treasure is protected by knowledge riddles\n' +
                      'üîÆ Use Ancient Wisdom (AI hints) when you need help\n' +
                      'üèÜ Complete quests to unlock new locations!\n\n' +
                      'Click on the glowing Crystal Cave to begin your adventure! ‚ú®');
            }, 1000);
        }

        // Event Listeners
        document.getElementById('solveBtn').onclick = solveRiddle;
        document.getElementById('hintBtn').onclick = getAncientWisdom;
        document.getElementById('continueBtn').onclick = continueQuest;

        // Start the adventure
        initAdventure();
    </script>
</body>
</html>