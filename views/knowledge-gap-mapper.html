<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Gap Mapper - LearnBuddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #4c1d95 0%, #5b21b6 50%, #6d28d9 100%);
        }
        .floating-card {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .question-appear {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feedback-appear {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header with Navigation -->
    <nav class="gradient-bg text-white py-6 shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-transparent"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="window.location.href='/'" class="flex items-center space-x-2 hover:bg-white/10 px-4 py-2 rounded-xl transition-all duration-300">
                        <span class="text-2xl">‚Üê</span>
                        <span class="font-semibold">Back to Home</span>
                    </button>
                </div>
                <div class="text-center">
                    <h1 class="text-3xl font-bold">üéØ Knowledge Gap Mapper</h1>
                    <p class="text-purple-200 mt-2">AI-Powered Learning Assessment</p>
                </div>
                <div class="w-32"></div> <!-- Spacer for center alignment -->
            </div>
        </div>
    </nav>

    <!-- Floating Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="floating-card absolute -left-24 top-20 w-64 h-64 bg-gradient-to-br from-red-400/20 to-red-600/20 rounded-full blur-3xl"></div>
        <div class="floating-card absolute -right-24 top-8 w-80 h-80 bg-gradient-to-br from-purple-400/20 to-purple-600/20 rounded-full blur-3xl" style="animation-delay: -2s;"></div>
        <div class="floating-card absolute -right-32 bottom-24 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-blue-600/20 rounded-full blur-3xl" style="animation-delay: -4s;"></div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-16 relative z-10">
        
        <!-- Progress Overview -->
        <div class="bg-white rounded-3xl p-8 shadow-xl border border-purple-100 mb-12">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Your Learning Progress</h2>
                <div class="text-right">
                    <div class="text-3xl font-bold text-red-600" id="score">0/0</div>
                    <div class="text-sm text-gray-600">Questions Correct</div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-red-50 border border-red-200 rounded-2xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">üìä</span>
                    </div>
                    <h3 class="font-bold text-red-800 mb-2">Accuracy Rate</h3>
                    <div class="text-2xl font-bold text-red-600" id="accuracy">0%</div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-2xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">‚≠ê</span>
                    </div>
                    <h3 class="font-bold text-blue-800 mb-2">Streak</h3>
                    <div class="text-2xl font-bold text-blue-600" id="streak">0</div>
                </div>
                
                <div class="bg-purple-50 border border-purple-200 rounded-2xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">üéØ</span>
                    </div>
                    <h3 class="font-bold text-purple-800 mb-2">Level</h3>
                    <div class="text-2xl font-bold text-purple-600" id="level">Beginner</div>
                </div>
            </div>
        </div>

        <!-- Question Area -->
        <div class="bg-white rounded-3xl p-10 shadow-xl border border-purple-100 mb-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Solve This Problem</h2>
                <div class="w-20 h-1 bg-gradient-to-r from-red-500 to-red-600 mx-auto rounded-full"></div>
            </div>
            
            <div class="max-w-2xl mx-auto">
                <div class="bg-gray-50 rounded-3xl p-8 mb-6 question-appear" id="question-container">
                    <div class="text-center mb-6">
                        <div class="text-lg font-semibold text-gray-600 mb-2">Question <span id="question-number">1</span></div>
                        <h3 class="text-3xl font-bold text-gray-800 mb-4" id="current-question">Solve: 3x + 2 = 8</h3>
                        <div class="text-gray-600" id="question-hint">Find the value of x</div>
                    </div>
                    
                    <div class="space-y-4">
                        <input type="text" id="gap-answer" placeholder="Enter your answer..." 
                               class="w-full border-2 border-gray-300 rounded-2xl px-6 py-4 text-lg text-center focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-300">
                        
                        <div class="flex items-center justify-between">
                            <div class="flex space-x-2" id="attempt-dots">
                                <div class="w-4 h-4 bg-gray-200 rounded-full transition-all duration-300"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded-full transition-all duration-300"></div>
                                <div class="w-4 h-4 bg-gray-200 rounded-full transition-all duration-300"></div>
                            </div>
                            <button onclick="checkGapAnswer()" 
                                    class="bg-gradient-to-r from-red-500 to-red-600 text-white px-8 py-3 rounded-2xl hover:from-red-600 hover:to-red-700 transition-all duration-300 font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                                Submit Answer
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Feedback Area -->
                <div id="gap-feedback" class="hidden feedback-appear"></div>
            </div>
        </div>

        <!-- Knowledge Gaps Identified -->
        <div class="bg-white rounded-3xl p-10 shadow-xl border border-purple-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üìà Knowledge Gaps Identified</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="knowledge-gaps">
                <div class="bg-orange-50 border border-orange-200 rounded-2xl p-6">
                    <h3 class="font-bold text-orange-800 mb-3">‚ö†Ô∏è Needs Practice</h3>
                    <ul class="space-y-2 text-orange-700" id="needs-practice">
                        <li class="flex items-center"><span class="w-2 h-2 bg-orange-400 rounded-full mr-3"></span>Complete your first question to see gaps</li>
                    </ul>
                </div>
                
                <div class="bg-green-50 border border-green-200 rounded-2xl p-6">
                    <h3 class="font-bold text-green-800 mb-3">‚úÖ Mastered Topics</h3>
                    <ul class="space-y-2 text-green-700" id="mastered-topics">
                        <li class="flex items-center"><span class="w-2 h-2 bg-green-400 rounded-full mr-3"></span>Start solving to track mastery</li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <button onclick="generateStudyPlan()" 
                        class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-3 rounded-2xl hover:from-purple-700 hover:to-purple-800 transition-all duration-300 font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                    üéØ Generate Personalized Study Plan
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        let currentQuestionIndex = 0;
        let gapAttempts = 0;
        let correctAnswers = 0;
        let totalAnswered = 0;
        let currentStreak = 0;
        let masteredTopics = [];
        let practiceNeeded = [];
        
        const questions = [
            {
                question: "Solve: 3x + 2 = 8",
                answer: ["2", "x=2", "x = 2"],
                hint: "Find the value of x",
                topic: "Linear Equations",
                explanation: "1. Start with: 3x + 2 = 8\n2. Subtract 2 from both sides: 3x = 6\n3. Divide by 3: x = 2",
                weakAreas: {
                    "isolation": "You might be struggling with isolating the variable. Remember to undo operations in reverse order.",
                    "arithmetic": "Check your basic arithmetic - subtraction and division steps need to be done carefully.",
                    "inverse": "Understanding inverse operations is key - if we add 2, we subtract 2 to cancel it out.",
                    "order": "The order of operations matters - handle addition/subtraction before division/multiplication."
                },
                commonMistakes: [
                    { wrong: "6", issue: "Forgot to divide by 3 after getting 3x = 6" },
                    { wrong: "3", issue: "Divided incorrectly or made arithmetic error" },
                    { wrong: "10", issue: "Added instead of subtracting 2 from both sides" }
                ]
            },
            {
                question: "What is 1/2 + 1/3?",
                answer: ["5/6", "5 / 6", "0.833", "0.83"],
                hint: "Add the fractions (find common denominator)",
                topic: "Fractions",
                explanation: "1. Find common denominator: 6\n2. Convert: 1/2 = 3/6 and 1/3 = 2/6\n3. Add: 3/6 + 2/6 = 5/6",
                weakAreas: {
                    "common_denominator": "Finding the least common denominator is the key first step in fraction addition.",
                    "equivalent_fractions": "Converting fractions to equivalent forms with the same denominator is crucial.",
                    "fraction_addition": "Once denominators match, only add the numerators, keep the denominator same.",
                    "simplification": "Always check if your final answer can be simplified to lowest terms."
                },
                commonMistakes: [
                    { wrong: "2/5", issue: "Added numerators and denominators incorrectly (1+1=2, 2+3=5)" },
                    { wrong: "1/5", issue: "Subtracted instead of added, or found wrong common denominator" },
                    { wrong: "3/6", issue: "Only converted one fraction, didn't add properly" }
                ]
            },
            {
                question: "Solve: 2x - 5 = 11",
                answer: ["8", "x=8", "x = 8"],
                hint: "Find the value of x",
                topic: "Linear Equations",
                explanation: "1. Start with: 2x - 5 = 11\n2. Add 5 to both sides: 2x = 16\n3. Divide by 2: x = 8",
                weakAreas: {
                    "sign_handling": "Pay attention to positive and negative signs when moving terms across the equals sign.",
                    "inverse_operations": "To undo subtraction, you need to add the same number to both sides.",
                    "coefficient_division": "When a variable has a coefficient, divide both sides by that coefficient.",
                    "equation_balance": "Whatever you do to one side of the equation, you must do to the other side."
                },
                commonMistakes: [
                    { wrong: "3", issue: "Forgot to add 5 to both sides before dividing" },
                    { wrong: "16", issue: "Found 2x = 16 but forgot to divide by 2" },
                    { wrong: "6", issue: "Subtracted 5 instead of adding 5, or made arithmetic error" }
                ]
            },
            {
                question: "What is 25% of 80?",
                answer: ["20", "20.0"],
                hint: "Calculate the percentage",
                topic: "Percentages",
                explanation: "1. Convert 25% to decimal: 0.25\n2. Multiply: 0.25 √ó 80 = 20",
                weakAreas: {
                    "percent_to_decimal": "Converting percentages to decimals by dividing by 100 is essential.",
                    "multiplication": "Understanding that 'of' in math usually means multiplication.",
                    "decimal_arithmetic": "Practice multiplying decimals with whole numbers.",
                    "percent_meaning": "25% means 25 out of 100, or 1/4 of the total amount."
                },
                commonMistakes: [
                    { wrong: "2000", issue: "Multiplied 25 √ó 80 instead of converting 25% to 0.25 first" },
                    { wrong: "2", issue: "Divided instead of multiplied, or used wrong decimal conversion" },
                    { wrong: "105", issue: "Added 25 to 80 instead of finding 25% of 80" }
                ]
            },
            {
                question: "Solve: x¬≤ = 16",
                answer: ["4", "¬±4", "+4", "-4", "4 or -4"],
                hint: "Find the square root",
                topic: "Quadratic Equations",
                explanation: "1. Take square root of both sides\n2. x = ¬±‚àö16 = ¬±4\n3. So x = 4 or x = -4",
                weakAreas: {
                    "square_roots": "Understanding that square root operation gives both positive and negative solutions.",
                    "notation": "The ¬± symbol means 'plus or minus' - both positive and negative values.",
                    "verification": "Always check your answers by substituting back into the original equation.",
                    "quadratic_basics": "This is a simple quadratic equation that can be solved by taking square roots."
                },
                commonMistakes: [
                    { wrong: "8", issue: "Confused squaring with doubling - remember 4¬≤ = 16, not 4 √ó 2" },
                    { wrong: "256", issue: "Squared 16 instead of finding the square root of 16" },
                    { wrong: "2", issue: "Took square root of 4 instead of 16, or made calculation error" }
                ]
            }
        ];
        
        function updateDisplay() {
            document.getElementById('score').textContent = `${correctAnswers}/${totalAnswered}`;
            document.getElementById('accuracy').textContent = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) + '%' : '0%';
            document.getElementById('streak').textContent = currentStreak;
            
            // Update level based on correct answers
            let level = "Beginner";
            if (correctAnswers >= 10) level = "Expert";
            else if (correctAnswers >= 5) level = "Advanced";
            else if (correctAnswers >= 3) level = "Intermediate";
            document.getElementById('level').textContent = level;
        }
        
        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            document.getElementById('question-number').textContent = currentQuestionIndex + 1;
            document.getElementById('current-question').textContent = question.question;
            document.getElementById('question-hint').textContent = question.hint;
            
            // Reset answer field and attempts
            document.getElementById('gap-answer').value = '';
            document.getElementById('gap-answer').disabled = false;
            document.getElementById('gap-feedback').classList.add('hidden');
            gapAttempts = 0;
            
            // Reset attempt dots
            const dots = document.getElementById('attempt-dots').children;
            for (let i = 0; i < dots.length; i++) {
                dots[i].classList.remove('bg-red-400', 'bg-green-400');
                dots[i].classList.add('bg-gray-200');
            }
            
            // Add animation
            document.getElementById('question-container').classList.remove('question-appear');
            setTimeout(() => {
                document.getElementById('question-container').classList.add('question-appear');
            }, 50);
        }
        
        function checkGapAnswer() {
            const userAnswer = document.getElementById('gap-answer').value.trim().toLowerCase();
            const question = questions[currentQuestionIndex];
            const feedback = document.getElementById('gap-feedback');
            const dots = document.getElementById('attempt-dots').children;
            
            gapAttempts++;
            
            // Update attempt dots
            if (gapAttempts <= 3) {
                dots[gapAttempts - 1].classList.remove('bg-gray-200');
            }
            
            // Check if answer is correct
            const isCorrect = question.answer.some(ans => ans.toLowerCase() === userAnswer);
            
            if (isCorrect) {
                dots[gapAttempts - 1].classList.add('bg-green-400');
                correctAnswers++;
                totalAnswered++;
                currentStreak++;
                
                // Add to mastered topics
                if (!masteredTopics.includes(question.topic)) {
                    masteredTopics.push(question.topic);
                }
                
                feedback.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-2xl p-6 text-green-800 text-center">
                        <div class="text-4xl mb-3">üéâ</div>
                        <p class="font-bold text-lg mb-2">Excellent! You got it right!</p>
                        <p class="text-sm mb-4">${question.explanation.replace(/\n/g, '<br>')}</p>
                        <button onclick="nextQuestion()" class="bg-green-500 text-white px-6 py-2 rounded-xl hover:bg-green-600 transition-colors font-semibold">
                            Next Question ‚Üí
                        </button>
                    </div>
                `;
                feedback.classList.remove('hidden');
                document.getElementById('gap-answer').disabled = true;
                
            } else if (gapAttempts >= 3) {
                dots[gapAttempts - 1].classList.add('bg-red-400');
                totalAnswered++;
                currentStreak = 0;
                
                // Add to practice needed
                if (!practiceNeeded.includes(question.topic)) {
                    practiceNeeded.push(question.topic);
                }
                
                // Analyze the specific weak areas based on the wrong answer
                const weaknessAnalysis = analyzeWeakness(userAnswer, question);
                
                feedback.innerHTML = `
                    <div class="bg-orange-50 border border-orange-200 rounded-2xl p-6 text-orange-800">
                        <div class="text-4xl mb-3 text-center">ü§î</div>
                        <p class="font-bold text-lg mb-3 text-center">Let me help you understand this better!</p>
                        
                        <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-4">
                            <h4 class="font-bold text-red-800 mb-2">üéØ Your Weak Areas in ${question.topic}:</h4>
                            <div class="space-y-2">
                                ${weaknessAnalysis.areas.map(area => `
                                    <div class="flex items-start space-x-2 text-sm">
                                        <span class="w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0"></span>
                                        <span class="text-red-700"><strong>${area.concept}:</strong> ${area.explanation}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        ${weaknessAnalysis.specificIssue ? `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4">
                            <h4 class="font-bold text-yellow-800 mb-2">üí° What went wrong with your answer "${userAnswer}":</h4>
                            <p class="text-yellow-700 text-sm">${weaknessAnalysis.specificIssue}</p>
                        </div>
                        ` : ''}
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
                            <h4 class="font-bold text-blue-800 mb-2">üìö Step-by-step solution:</h4>
                            <div class="text-sm text-blue-700">
                                ${question.explanation.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="nextQuestion()" class="bg-orange-500 text-white px-6 py-2 rounded-xl hover:bg-orange-600 transition-colors font-semibold">
                                Practice Similar Problem
                            </button>
                        </div>
                    </div>
                `;
                feedback.classList.remove('hidden');
                
            } else {
                dots[gapAttempts - 1].classList.add('bg-red-400');
                
                // Provide targeted hint based on weak areas
                const hintAnalysis = analyzeWeakness(userAnswer, question);
                
                feedback.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-2xl p-4 text-red-800">
                        <p class="font-semibold mb-2">Not quite right. Let me give you a targeted hint!</p>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                            <p class="text-yellow-800 text-sm"><strong>üí° Hint:</strong> ${hintAnalysis.hint}</p>
                        </div>
                        <p class="text-sm">You have ${3 - gapAttempts} attempts left.</p>
                    </div>
                `;
                feedback.classList.remove('hidden');
            }
            
            updateDisplay();
            updateKnowledgeGaps();
            document.getElementById('gap-answer').value = '';
        }
        
        function analyzeWeakness(userAnswer, question) {
            const weakAreas = [];
            let specificIssue = null;
            let hint = "Try to break down the problem step by step.";
            
            // Check for common mistakes first
            const mistake = question.commonMistakes?.find(m => m.wrong.toLowerCase() === userAnswer);
            if (mistake) {
                specificIssue = mistake.issue;
            }
            
            // Analyze based on question type and user's answer
            if (question.topic === "Linear Equations") {
                if (userAnswer.includes("6") || userAnswer.includes("3x")) {
                    weakAreas.push({
                        concept: "Variable Isolation",
                        explanation: question.weakAreas.isolation
                    });
                    hint = "You're on the right track! Don't forget the final step - divide both sides by the coefficient of x.";
                } else if (parseInt(userAnswer) > 10) {
                    weakAreas.push({
                        concept: "Inverse Operations",
                        explanation: question.weakAreas.inverse
                    });
                    hint = "Check the signs carefully. If the equation has +2, you need to subtract 2 from both sides.";
                } else {
                    weakAreas.push({
                        concept: "Order of Operations",
                        explanation: question.weakAreas.order
                    });
                    weakAreas.push({
                        concept: "Basic Arithmetic",
                        explanation: question.weakAreas.arithmetic
                    });
                    hint = "Double-check your arithmetic. Follow the steps: subtract first, then divide.";
                }
            } else if (question.topic === "Fractions") {
                if (userAnswer.includes("/")) {
                    const parts = userAnswer.split("/");
                    if (parts[1] !== "6") {
                        weakAreas.push({
                            concept: "Common Denominator",
                            explanation: question.weakAreas.common_denominator
                        });
                        hint = "The least common denominator of 2 and 3 is 6. Convert both fractions to have denominator 6.";
                    } else {
                        weakAreas.push({
                            concept: "Equivalent Fractions",
                            explanation: question.weakAreas.equivalent_fractions
                        });
                        hint = "1/2 = 3/6 and 1/3 = 2/6. Now add the numerators: 3 + 2 = ?";
                    }
                } else {
                    weakAreas.push({
                        concept: "Fraction Addition Process",
                        explanation: question.weakAreas.fraction_addition
                    });
                    hint = "This is a fraction addition problem. You need to find a common denominator first.";
                }
            } else if (question.topic === "Percentages") {
                if (parseInt(userAnswer) > 100) {
                    weakAreas.push({
                        concept: "Percent to Decimal",
                        explanation: question.weakAreas.percent_to_decimal
                    });
                    hint = "25% = 25/100 = 0.25. Don't forget to convert the percentage to a decimal first!";
                } else {
                    weakAreas.push({
                        concept: "Percentage Calculation",
                        explanation: question.weakAreas.multiplication
                    });
                    hint = "'25% of 80' means 0.25 √ó 80. The word 'of' usually means multiplication in math.";
                }
            } else if (question.topic === "Quadratic Equations") {
                if (parseInt(userAnswer) > 16) {
                    weakAreas.push({
                        concept: "Square vs Square Root",
                        explanation: "You might be squaring instead of taking the square root. ‚àö16 = 4, not 16¬≤."
                    });
                    hint = "We need to find what number, when squared, equals 16. Think: what √ó what = 16?";
                } else if (userAnswer === "4") {
                    weakAreas.push({
                        concept: "Positive and Negative Solutions",
                        explanation: question.weakAreas.square_roots
                    });
                    hint = "You found one solution! But remember, both 4¬≤ = 16 and (-4)¬≤ = 16. So x can be +4 or -4.";
                } else {
                    weakAreas.push({
                        concept: "Square Root Basics",
                        explanation: question.weakAreas.square_roots
                    });
                    hint = "To solve x¬≤ = 16, take the square root of both sides. ‚àö16 = ?";
                }
            }
            
            // If no specific weak areas identified, use general ones
            if (weakAreas.length === 0) {
                Object.entries(question.weakAreas).slice(0, 2).forEach(([key, value]) => {
                    weakAreas.push({
                        concept: key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                        explanation: value
                    });
                });
            }
            
            return {
                areas: weakAreas,
                specificIssue,
                hint
            };
        }
        
        function nextQuestion() {
            currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
            loadQuestion();
        }
        
        function updateKnowledgeGaps() {
            const practiceList = document.getElementById('needs-practice');
            const masteredList = document.getElementById('mastered-topics');
            
            if (practiceNeeded.length > 0) {
                const detailedWeakAreas = practiceNeeded.map(topic => {
                    const topicAreas = getDetailedWeakAreas(topic);
                    return `
                        <li class="bg-white rounded-lg p-3 border border-orange-300">
                            <div class="flex items-center mb-2">
                                <span class="w-3 h-3 bg-orange-400 rounded-full mr-3"></span>
                                <span class="font-semibold text-orange-800">${topic}</span>
                            </div>
                            <div class="text-xs text-orange-600 ml-6 space-y-1">
                                ${topicAreas.map(area => `<div>‚Ä¢ ${area}</div>`).join('')}
                            </div>
                        </li>
                    `;
                }).join('');
                practiceList.innerHTML = detailedWeakAreas;
            }
            
            if (masteredTopics.length > 0) {
                masteredList.innerHTML = masteredTopics.map(topic => 
                    `<li class="flex items-center"><span class="w-2 h-2 bg-green-400 rounded-full mr-3"></span>${topic}</li>`
                ).join('');
            }
        }
        
        function getDetailedWeakAreas(topic) {
            const weakAreasByTopic = {
                "Linear Equations": [
                    "Variable isolation techniques",
                    "Inverse operations understanding",
                    "Sign handling and equation balance",
                    "Coefficient division steps"
                ],
                "Fractions": [
                    "Finding common denominators",
                    "Converting to equivalent fractions",
                    "Fraction addition rules",
                    "Simplifying results"
                ],
                "Percentages": [
                    "Converting percentages to decimals",
                    "Understanding 'of' means multiplication",
                    "Decimal arithmetic skills",
                    "Percentage concept understanding"
                ],
                "Quadratic Equations": [
                    "Square root operations",
                    "Positive and negative solutions",
                    "Equation verification methods",
                    "Basic quadratic concepts"
                ]
            };
            
            return weakAreasByTopic[topic] || [`${topic} fundamentals`, `${topic} problem-solving steps`];
        }
        
        function generateStudyPlan() {
            alert('üéØ Study Plan Generated!\n\nBased on your performance, we recommend:\n\n' + 
                  (practiceNeeded.length > 0 ? 'üìö Focus on: ' + practiceNeeded.join(', ') + '\n' : '') +
                  (masteredTopics.length > 0 ? '‚úÖ Continue practicing: ' + masteredTopics.join(', ') + '\n' : '') +
                  '\nKeep up the great work! üåü');
        }
        
        // Allow Enter key for input
        document.getElementById('gap-answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkGapAnswer();
            }
        });
        
        // Initialize
        loadQuestion();
        updateDisplay();
    </script>
</body>
</html>