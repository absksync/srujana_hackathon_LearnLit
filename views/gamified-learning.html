<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamified Learning Hub - LearnBuddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .game-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .achievement-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .token-counter {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            font-weight: bold;
        }
        .progress-bar {
            background: linear-gradient(90deg, #4CAF50, #45a049);
        }
        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 215, 0, 0.8);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-10px) rotate(360deg); opacity: 0; }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    },
                    colors: {
                        'purple': {
                            '900': '#2D1B69',
                            '800': '#3B2A87',
                            '700': '#4C3BAF',
                            '600': '#6B46C1',
                            '500': '#8B5CF6',
                            '400': '#A78BFA',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-purple-900 via-purple-800 to-purple-700 min-h-screen font-sans text-white">
    
    <!-- Floating Particles Background -->
    <div class="floating-particles">
        <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 20%; animation-delay: 1s;"></div>
        <div class="particle" style="left: 30%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 40%; animation-delay: 3s;"></div>
        <div class="particle" style="left: 50%; animation-delay: 4s;"></div>
        <div class="particle" style="left: 60%; animation-delay: 5s;"></div>
        <div class="particle" style="left: 70%; animation-delay: 1.5s;"></div>
        <div class="particle" style="left: 80%; animation-delay: 2.5s;"></div>
        <div class="particle" style="left: 90%; animation-delay: 3.5s;"></div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 bg-gradient-to-r from-purple-900/95 via-purple-800/95 to-purple-700/95 backdrop-blur-xl border-b border-white/10 z-50">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                        <span class="text-white text-xl font-bold">üéÆ</span>
                    </div>
                    <span class="text-white text-xl font-bold">Gamified Learning Hub</span>
                </div>
                
                <!-- Player Stats -->
                <div class="flex items-center space-x-4">
                    <div class="token-counter px-4 py-2 rounded-full text-sm">
                        <span id="tokenCount">ü™ô 150</span>
                    </div>
                    <div class="bg-white/20 px-4 py-2 rounded-full text-sm">
                        <span id="xpCount">‚≠ê 1,250 XP</span>
                    </div>
                    <button onclick="window.history.back()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all">
                        ‚Üê Back
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 pb-12">
        <!-- Hero Section -->
        <div class="max-w-7xl mx-auto px-6 lg:px-8 text-center mb-12">
            <div class="bg-gradient-to-r from-purple-600/30 to-purple-400/30 backdrop-blur-lg rounded-3xl p-8 border border-white/10">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">
                    üéÆ Learn Through Play
                </h1>
                <p class="text-xl text-purple-100 mb-6 max-w-3xl mx-auto">
                    Master your subjects through exciting games, earn tokens, unlock achievements, and redeem real rewards!
                </p>
                
                <!-- Progress Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-8">
                    <div class="bg-white/10 rounded-xl p-4">
                        <div class="text-2xl font-bold text-green-300" id="gamesCompleted">12</div>
                        <div class="text-sm text-purple-200">Games Completed</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-4">
                        <div class="text-2xl font-bold text-yellow-300" id="achievementsUnlocked">8</div>
                        <div class="text-sm text-purple-200">Achievements</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-4">
                        <div class="text-2xl font-bold text-blue-300" id="currentStreak">5</div>
                        <div class="text-sm text-purple-200">Day Streak</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-4">
                        <div class="text-2xl font-bold text-pink-300" id="totalScore">2,450</div>
                        <div class="text-sm text-purple-200">Total Score</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Categories -->
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            
            <!-- Adventure Games Section -->
            <div class="mb-12">
                <h2 class="text-3xl font-bold mb-6 flex items-center">
                    üó∫Ô∏è Adventure Learning Games
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    
                    <!-- Mario Learning Quest -->
                    <div class="game-card rounded-2xl p-6 cursor-pointer" onclick="launchGame('mario')">
                        <div class="text-4xl mb-4">üçÑ</div>
                        <h3 class="text-xl font-bold mb-2">Mario Learning Quest</h3>
                        <p class="text-purple-100 text-sm mb-4">Jump through 10 levels by solving educational challenges!</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs">ü™ô 20 tokens</span>
                            <span class="text-yellow-300">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 70%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-2">Progress: 7/10 levels</div>
                    </div>

                    <!-- Treasure Hunt Academy -->
                    <div class="game-card rounded-2xl p-6 cursor-pointer" onclick="launchGame('treasure')">
                        <div class="text-4xl mb-4">üè¥‚Äç‚ò†Ô∏è</div>
                        <h3 class="text-xl font-bold mb-2">Treasure Hunt Academy</h3>
                        <p class="text-purple-100 text-sm mb-4">Discover hidden treasures by solving ancient riddles!</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-xs">ü™ô 25 tokens</span>
                            <span class="text-yellow-300">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 40%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-2">Progress: 2/5 treasures</div>
                    </div>

                    <!-- Subway Surfer Educational -->
                    <div class="game-card rounded-2xl p-6 cursor-pointer" onclick="launchGame('subway')">
                        <div class="text-4xl mb-4">üöá</div>
                        <h3 class="text-xl font-bold mb-2">Subway Learning Rush</h3>
                        <p class="text-purple-100 text-sm mb-4">Run and answer questions in this fast-paced adventure!</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-xs">ü™ô 15 tokens</span>
                            <span class="text-yellow-300">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 85%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-2">High Score: 2,450 points</div>
                    </div>
                </div>
            </div>

            <!-- Study Games Section -->
            <div class="mb-12">
                <h2 class="text-3xl font-bold mb-6 flex items-center">
                    üìö Interactive Study Games
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    
                    <!-- Duolingo Style Learning -->
                    <div class="game-card rounded-2xl p-6 cursor-pointer" onclick="launchGame('duolingo')">
                        <div class="text-4xl mb-4">ü¶â</div>
                        <h3 class="text-xl font-bold mb-2">Subject Mastery Path</h3>
                        <p class="text-purple-100 text-sm mb-4">Follow structured learning paths with instant feedback!</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs">ü™ô 10 tokens</span>
                            <span class="text-yellow-300">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 60%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-2">Current: Science Level 6</div>
                    </div>

                    <!-- Quiz Challenge Arena -->
                    <div class="game-card rounded-2xl p-6 cursor-pointer" onclick="launchGame('quiz')">
                        <div class="text-4xl mb-4">üß†</div>
                        <h3 class="text-xl font-bold mb-2">Quiz Challenge Arena</h3>
                        <p class="text-purple-100 text-sm mb-4">Test your knowledge in rapid-fire quiz battles!</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="bg-red-500 text-white px-3 py-1 rounded-full text-xs">ü™ô 8 tokens</span>
                            <span class="text-yellow-300">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 90%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-2">Win Rate: 89%</div>
                    </div>

                    <!-- AI Tutor Challenge -->
                    <div class="game-card rounded-2xl p-6 cursor-pointer" onclick="launchGame('ai-tutor')">
                        <div class="text-4xl mb-4">ü§ñ</div>
                        <h3 class="text-xl font-bold mb-2">AI Tutor Challenge</h3>
                        <p class="text-purple-100 text-sm mb-4">Learn with AI hints, step-by-step guidance, and mnemonics!</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="bg-purple-500 text-white px-3 py-1 rounded-full text-xs">ü™ô 12 tokens</span>
                            <span class="text-yellow-300">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 45%"></div>
                        </div>
                        <div class="text-xs text-purple-200 mt-2">AI Assist Level: 3</div>
                    </div>
                </div>
            </div>

            <!-- Rewards & Achievements Section -->
            <div class="mb-12">
                <h2 class="text-3xl font-bold mb-6 flex items-center">
                    üèÜ Rewards & Achievements
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Student Rewards Shop -->
                    <div class="bg-gradient-to-r from-yellow-600/30 to-orange-600/30 backdrop-blur-lg rounded-2xl p-6 border border-white/10 cursor-pointer" onclick="launchRewardsShop()">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-2xl font-bold">üè™ Rewards Shop</h3>
                            <span class="bg-yellow-500 text-black px-3 py-1 rounded-full text-sm font-bold">ü™ô Your Tokens: 150</span>
                        </div>
                        <p class="text-purple-100 mb-4">Redeem your hard-earned tokens for real rewards!</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white/10 rounded-lg p-3">
                                <div class="text-sm text-purple-200">üìù Stationery Set</div>
                                <div class="text-yellow-300 font-bold">50 tokens</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-3">
                                <div class="text-sm text-purple-200">üìö Premium Course</div>
                                <div class="text-yellow-300 font-bold">150 tokens</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-3">
                                <div class="text-sm text-purple-200">üéÆ Learning Kit</div>
                                <div class="text-yellow-300 font-bold">200 tokens</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-3">
                                <div class="text-sm text-purple-200">üèÖ Certificate</div>
                                <div class="text-yellow-300 font-bold">25 tokens</div>
                            </div>
                        </div>
                    </div>

                    <!-- Achievements Gallery -->
                    <div class="bg-gradient-to-r from-purple-600/30 to-pink-600/30 backdrop-blur-lg rounded-2xl p-6 border border-white/10">
                        <h3 class="text-2xl font-bold mb-4">üèÖ Recent Achievements</h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3 bg-white/10 rounded-lg p-3 achievement-badge">
                                <span class="text-2xl">üî•</span>
                                <div>
                                    <div class="font-semibold">Streak Master</div>
                                    <div class="text-sm text-purple-200">5-day learning streak!</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 bg-white/10 rounded-lg p-3">
                                <span class="text-2xl">üéØ</span>
                                <div>
                                    <div class="font-semibold">Accuracy Expert</div>
                                    <div class="text-sm text-purple-200">90% quiz accuracy</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 bg-white/10 rounded-lg p-3">
                                <span class="text-2xl">‚≠ê</span>
                                <div>
                                    <div class="font-semibold">High Scorer</div>
                                    <div class="text-sm text-purple-200">1000+ points earned</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Section -->
            <div class="mb-12">
                <h2 class="text-3xl font-bold mb-6 flex items-center">
                    üèÜ Global Leaderboard
                </h2>
                <div class="bg-gradient-to-r from-blue-600/30 to-purple-600/30 backdrop-blur-lg rounded-2xl p-6 border border-white/10">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-xl font-bold mb-4">ü™ô Top Token Earners</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between bg-yellow-500/20 rounded-lg p-3">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-yellow-500 font-bold">1st</span>
                                        <span>StudentA</span>
                                    </div>
                                    <span class="text-yellow-300 font-bold">2,450 ü™ô</span>
                                </div>
                                <div class="flex items-center justify-between bg-gray-300/20 rounded-lg p-3">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-gray-300 font-bold">2nd</span>
                                        <span>You</span>
                                    </div>
                                    <span class="text-gray-300 font-bold">1,890 ü™ô</span>
                                </div>
                                <div class="flex items-center justify-between bg-orange-500/20 rounded-lg p-3">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-orange-500 font-bold">3rd</span>
                                        <span>StudentC</span>
                                    </div>
                                    <span class="text-orange-300 font-bold">1,675 ü™ô</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-xl font-bold mb-4">‚ö° This Week's Champions</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between bg-green-500/20 rounded-lg p-3">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-green-500 font-bold">ü•á</span>
                                        <span>QuizMaster</span>
                                    </div>
                                    <span class="text-green-300 font-bold">15 wins</span>
                                </div>
                                <div class="flex items-center justify-between bg-blue-500/20 rounded-lg p-3">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-blue-500 font-bold">ü•à</span>
                                        <span>BrainBox</span>
                                    </div>
                                    <span class="text-blue-300 font-bold">12 wins</span>
                                </div>
                                <div class="flex items-center justify-between bg-purple-500/20 rounded-lg p-3">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-purple-500 font-bold">ü•â</span>
                                        <span>StudyHero</span>
                                    </div>
                                    <span class="text-purple-300 font-bold">10 wins</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 text-center">
            <div class="animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Launching Game...</h3>
            <p class="text-gray-600">Connecting to backend services</p>
        </div>
    </div>

    <!-- Game Container Modal -->
    <div id="gameModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 hidden">
        <div class="w-full h-full flex flex-col">
            <div class="flex justify-between items-center p-4 bg-black/50">
                <h3 id="gameTitle" class="text-white text-xl font-bold"></h3>
                <button onclick="closeGame()" class="text-white hover:text-red-400 text-2xl">√ó</button>
            </div>
            <iframe id="gameFrame" class="flex-1 w-full border-0" src=""></iframe>
        </div>
    </div>

    <script src="/js/ai-services.js"></script>
    <script src="/js/gamified-learning-service.js"></script>
    <script>
        // Initialize services
        const gamingService = window.gamifiedLearning;

        // Game launch functions with full backend integration
        async function launchGame(gameType) {
            showLoading();
            
            try {
                switch(gameType) {
                    case 'mario':
                        await gamingService.launchMarioQuest();
                        break;
                    case 'treasure':
                        await gamingService.launchTreasureHunt();
                        break;
                    case 'subway':
                        await gamingService.launchSubwaySurfer();
                        break;
                    case 'duolingo':
                        await gamingService.launchDuolingoStyle();
                        break;
                    case 'quiz':
                        await startQuizChallenge();
                        break;
                    case 'ai-tutor':
                        await startAITutorChallenge();
                        break;
                }
            } catch (error) {
                console.error('Error launching game:', error);
                showErrorMessage('Game is currently unavailable. Please try again later.');
            } finally {
                hideLoading();
            }
        }

        async function startQuizChallenge() {
            const subjects = ['Mathematics', 'Science', 'English', 'History'];
            const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
            
            const quizData = await gamingService.startQuizChallenge(randomSubject.toLowerCase());
            createEmbeddedQuiz(quizData);
        }

        async function startAITutorChallenge() {
            const topics = ['Algebra', 'Geometry', 'Physics', 'Chemistry', 'Biology'];
            const randomTopic = topics[Math.floor(Math.random() * topics.length)];
            
            const tutorData = await gamingService.startAITutorChallenge(randomTopic);
            openGameModal('ü§ñ AI Tutor Challenge', `/doubt-resolver?topic=${randomTopic}&mode=challenge`);
        }

        function launchRewardsShop() {
            showLoading();
            gamingService.launchRewardsShop()
                .then(() => hideLoading())
                .catch(() => {
                    hideLoading();
                    showErrorMessage('Rewards shop is currently unavailable.');
                });
        }

        function createEmbeddedQuiz(quizData) {
            const quizContainer = document.createElement('div');
            quizContainer.className = 'fixed inset-0 bg-black/90 z-50 flex items-center justify-center';
            quizContainer.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">üß† Quiz Challenge</h3>
                        <button onclick="closeQuiz()" class="text-gray-500 hover:text-red-500 text-2xl">√ó</button>
                    </div>
                    <div id="quizContent">
                        <div class="text-center">
                            <div class="text-4xl mb-4">üéØ</div>
                            <h4 class="text-xl font-semibold mb-4">Ready to start your quiz challenge?</h4>
                            <p class="text-gray-600 mb-6">Answer ${quizData.questions.length} questions to earn tokens!</p>
                            <button onclick="startQuizTimer()" class="bg-blue-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-all">
                                Start Quiz! üöÄ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(quizContainer);
            window.currentQuizData = quizData;
            window.currentQuizContainer = quizContainer;
        }

        window.closeQuiz = function() {
            if (window.currentQuizContainer) {
                document.body.removeChild(window.currentQuizContainer);
                window.currentQuizContainer = null;
                window.currentQuizData = null;
            }
        };

        window.startQuizTimer = function() {
            // Implementation for quiz timer and questions
            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 mb-4">Quiz Started! üéÆ</div>
                    <p class="text-gray-600">Quiz functionality will be implemented here with backend integration.</p>
                    <button onclick="closeQuiz()" class="mt-6 bg-green-500 text-white px-6 py-2 rounded-lg">
                        Complete Quiz (+50 tokens) ü™ô
                    </button>
                </div>
            `;
            
            // Award completion tokens
            setTimeout(() => {
                gamingService.awardTokens(50, 'Quiz Completion');
                updatePlayerStats();
            }, 1000);
        };

        function openGameModal(title, url) {
            document.getElementById('gameTitle').textContent = title;
            document.getElementById('gameFrame').src = url;
            document.getElementById('gameModal').classList.remove('hidden');
        }

        function closeGame() {
            document.getElementById('gameModal').classList.add('hidden');
            document.getElementById('gameFrame').src = '';
            updatePlayerStats();
        }

        function showLoading() {
            document.getElementById('loadingModal').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingModal').classList.add('hidden');
        }

        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-20 right-4 bg-red-500 text-white px-6 py-3 rounded-lg z-50';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (document.body.contains(errorDiv)) {
                    document.body.removeChild(errorDiv);
                }
            }, 3000);
        }

        // Update player statistics from service
        function updatePlayerStats() {
            const stats = gamingService.playerStats;
            document.getElementById('tokenCount').textContent = `ü™ô ${stats.tokens}`;
            document.getElementById('xpCount').textContent = `‚≠ê ${stats.xp} XP`;
            document.getElementById('gamesCompleted').textContent = stats.gamesCompleted;
            document.getElementById('achievementsUnlocked').textContent = stats.achievements;
            document.getElementById('currentStreak').textContent = stats.currentStreak;
            document.getElementById('totalScore').textContent = stats.totalScore;
        }

        // Listen for stats updates
        window.addEventListener('statsUpdated', function(event) {
            updatePlayerStats();
        });

        // Handle messages from game iframes
        window.addEventListener('message', function(event) {
            if (event.data.type === 'GAME_EVENT') {
                handleGameEvent(event.data);
            }
        });

        function handleGameEvent(data) {
            switch(data.event) {
                case 'TOKEN_EARNED':
                    gamingService.awardTokens(data.amount, data.reason);
                    break;
                case 'ACHIEVEMENT_UNLOCKED':
                    gamingService.unlockAchievement(data.achievement);
                    break;
                case 'LEVEL_COMPLETED':
                    gamingService.awardXP(data.xp);
                    updateProgressBars();
                    break;
                case 'GAME_COMPLETED':
                    gamingService.playerStats.gamesCompleted += 1;
                    gamingService.savePlayerStats();
                    updatePlayerStats();
                    break;
            }
        }

        function updateProgressBars() {
            // Update progress bars based on current game state
            updatePlayerStats();
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updatePlayerStats();
            
            // Demo achievements on page load
            setTimeout(() => {
                gamingService.unlockAchievement({
                    id: 'daily_login',
                    name: 'Daily Learner',
                    description: 'Visited the gamified learning hub today!',
                    icon: 'üéØ',
                    reward: 5
                });
            }, 2000);

            // Load sample NCERT questions
            loadSampleQuestions();
        });

        // Load sample questions function
        async function loadSampleQuestions() {
            try {
                const response = await fetch('/api/quiz/questions?limit=3');
                const data = await response.json();
                
                if (data.success && data.questions.length > 0) {
                    displaySampleQuestions(data.questions);
                } else {
                    showFallbackMessage();
                }
            } catch (error) {
                console.error('Error loading sample questions:', error);
                showFallbackMessage();
            }
        }

        function displaySampleQuestions(questions) {
            // Create sample quiz section if it doesn't exist
            let sampleQuizSection = document.getElementById('sampleQuizSection');
            if (!sampleQuizSection) {
                const leaderboardContainer = document.querySelector('.container.mx-auto.px-4.py-8');
                const sampleQuizHTML = `
                    <div id="sampleQuizSection" class="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            üß† Sample NCERT Quiz Questions
                            <span class="ml-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Live Backend</span>
                        </h3>
                        <div id="sampleQuizContainer" class="space-y-4">
                        </div>
                    </div>
                `;
                leaderboardContainer.insertAdjacentHTML('beforeend', sampleQuizHTML);
            }

            const container = document.getElementById('sampleQuizContainer');
            container.innerHTML = questions.map((q, index) => `
                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                    <div class="flex justify-between items-start mb-2">
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                            Class ${q.class} ${q.subject}
                        </span>
                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">
                            ${q.difficulty}
                        </span>
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-3">${q.question}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        ${q.options.map((option, i) => `
                            <div class="p-2 bg-gray-100 rounded cursor-pointer hover:bg-blue-100 transition-colors">
                                ${String.fromCharCode(65 + i)}. ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-3 text-sm text-gray-600">
                        üí° Topic: ${q.chapter}
                    </div>
                </div>
            `).join('');

            // Add test quiz button
            container.innerHTML += `
                <div class="text-center mt-6">
                    <button onclick="startFullQuiz()" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105">
                        üéÆ Test NCERT Quiz System
                    </button>
                </div>
            `;
        }

        function showFallbackMessage() {
            const container = document.getElementById('sampleQuizContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-600">
                        <div class="text-4xl mb-4">üìö</div>
                        <p>Backend quiz system is loading...</p>
                        <p class="text-sm mt-2">NCERT questions will appear when backend is ready</p>
                    </div>
                `;
            }
        }

        async function startFullQuiz() {
            try {
                const response = await fetch('/api/quiz/questions?limit=5&subject=Science');
                const data = await response.json();
                
                if (data.success) {
                    alert(`üéâ Quiz loaded successfully!\n\n‚úÖ ${data.questions.length} NCERT Science questions found\n‚úÖ Backend integration working\n‚úÖ MCQ format with options\n\nIn the full version, this would open an interactive quiz interface with scoring and token rewards!`);
                } else {
                    alert('No questions found. Please ensure the backend is running.');
                }
            } catch (error) {
                alert('Quiz system is starting up. Please try again in a moment!');
            }
        }
    </script>
</body>
</html>